<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Mobile Chat</title>
    <link rel="icon" href="data:,">
    <!-- –ê–Ω—Ç–∏–∫–µ—à –º–µ—Ç–∞-—Ç–µ–≥–∏ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="stylesheet" href="style.css?v=3.0">
</head>
<body class="theme-blue">
    <div id="login-screen">
        <div class="login-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="margin-bottom: 0;">üîê –ù–æ–≤—ã–π —á–∞—Ç</h2>
                <button id="loginSettingsBtn" style="background: transparent; border: 1px solid var(--border); border-radius: 50%; width: 44px; height: 44px; font-size: 1.5rem; cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--text-primary);">‚öôÔ∏è</button>
            </div>
            <input type="text" id="userName" placeholder="–í–∞—à–µ –∏–º—è (–≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö)" autocomplete="off">
            <div class="input-hint">–ò–º—è, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥—É—Ç –≤–∏–¥–µ—Ç—å –¥—Ä—É–≥–∏–µ</div>
            <input type="text" id="seedPhrase" class="seed-field" placeholder="–°–∏–¥-—Ñ—Ä–∞–∑–∞ (ID –≥—Ä—É–ø–ø—ã)" autocomplete="off">
            <div class="input-hint">–û–±—â–∏–π ID –≥—Ä—É–ø–ø—ã ‚Äì –≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –≤–≤–æ–¥—è—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π</div>
            <input type="text" id="yandexToken" placeholder="–¢–æ–∫–µ–Ω –Ø–Ω–¥–µ–∫—Å–∞ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å y0_...)" autocomplete="off">
            <div class="input-hint">–¢–æ–∫–µ–Ω –æ—Ç –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞ (–æ–¥–∏–Ω –Ω–∞ –≤—Å–µ—Ö)</div>
            <div class="token-help">
                <p>üîë <a href="https://yandex.ru/dev/disk/poligon/" target="_blank" rel="noopener noreferrer">–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω</a></p>
            </div>
            <button id="loginBtn">–í–æ–π—Ç–∏ –≤ —á–∞—Ç</button>
            <button class="cancel-btn" id="cancelLoginBtn">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <div id="chat-screen">
        <div class="main-container">
            <div class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <span>–ß–∞—Ç—ã</span>
                    <button class="add-chat-btn" id="addChatBtn">+</button>
                </div>
                <div id="chat-list" class="chat-list"></div>
                <div class="current-user-info" id="currentUserInfo">
                    <div class="current-user-avatar" id="currentUserAvatar">
                        <img src="" alt="" style="display: none;">
                        <span>üë§</span>
                    </div>
                    <span id="currentUserDisplay"></span>
                    <button class="change-avatar-btn" id="changeAvatarBtn" title="–°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä">üì∑</button>
                </div>
                <div class="settings-item" id="settingsBtn">
                    <span>‚öôÔ∏è</span> –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </div>
            </div>
            <div class="sidebar-overlay" id="sidebarOverlay"></div>

            <div class="chat-area">
                <div class="header">
                    <button class="menu-btn" id="menuBtn">‚ò∞</button>
                    <span class="header-title" id="display-name"></span>
                    <div class="header-controls">
                        <button id="participantsBtn" title="–£—á–∞—Å—Ç–Ω–∏–∫–∏">üë•</button>
                        <button id="refreshBtn" title="–û–±–Ω–æ–≤–∏—Ç—å">‚ü≥</button>
                    </div>
                </div>

                <div class="pinned-messages" id="pinnedContainer" style="display: none;"></div>
                <div class="typing-indicator" id="typingIndicator"></div>
                <div class="ptr-indicator" id="ptrIndicator">‚¨áÔ∏è –ü–æ—Ç—è–Ω–∏—Ç–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</div>
                <div id="messages"></div>

                <div class="input-wrapper">
                    <div id="file-preview-container"></div>

                    <!-- –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω—ã -->
                    <div class="voice-recorder" id="voiceRecorder" style="display: none;"></div>

                    <div class="quote-indicator" id="quoteIndicator" style="display: none;">
                        <span id="quoteText"></span>
                        <button id="cancelQuoteBtn">‚úñ</button>
                    </div>

                    <div id="uploadIndicator" class="upload-indicator">
                        <div class="spinner"></div>
                        <span id="uploadStatusText">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                        <span id="uploadProgress"></span>
                        <button class="cancel-btn" id="cancelUploadBtn">–û—Ç–º–µ–Ω–∏—Ç—å</button>
                    </div>

                    <div class="input-area">
                        <button class="attach-btn" id="attachBtn" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª—ã">üìé</button>
                        <!-- –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω—ã -->
                        <input type="file" id="fileInput" style="display: none;" multiple>
                        <input type="text" id="msgInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." autocomplete="off">
                        <button class="send-btn" id="sendBtn">‚û§</button>
                    </div>

                    <div class="markdown-hint">
                        <span>**–∂–∏—Ä–Ω—ã–π**</span> <span>*–∫—É—Ä—Å–∏–≤*</span> <span>`–∫–æ–¥`</span> <span>[—Ç–µ–∫—Å—Ç](—Å—Å—ã–ª–∫–∞)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
            <div class="settings-section">
                <h4>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h4>
                <div class="setting-option" id="notificationsToggle">
                    <span class="setting-label">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</span>
                    <span class="setting-value" id="notificationsValue">–í–∫–ª</span>
                </div>
                <div class="setting-option" id="soundToggle">
                    <span class="setting-label">–ó–≤—É–∫</span>
                    <span class="setting-value" id="soundValue">–í–∫–ª</span>
                </div>
                <div class="setting-option" id="vibrationToggle">
                    <span class="setting-label">–í–∏–±—Ä–∞—Ü–∏—è</span>
                    <span class="setting-value" id="vibrationValue">–í–∫–ª</span>
                </div>
            </div>
            <div class="settings-section">
                <h4>–ú–æ–¥–µ—Ä–∞—Ü–∏—è</h4>
                <div class="setting-option" id="censorToggle">
                    <span class="setting-label">–¶–µ–Ω–∑—É—Ä–∞ (—Ñ–∏–ª—å—Ç—Ä –º–∞—Ç–∞)</span>
                    <span class="setting-value" id="censorValue">–í—ã–∫–ª</span>
                </div>
            </div>
            
            <!-- –°–µ–∫—Ü–∏—è –ø—Ä–æ–∫—Å–∏ –ü–û–õ–ù–û–°–¢–¨–Æ –£–î–ê–õ–ï–ù–ê –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ -->

            <div class="settings-section">
                <h4>–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</h4>
                <div class="setting-option" id="themeToggle">
                    <span class="setting-label" id="themeLabel">–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ —Å–≤–µ—Ç–ª—É—é —Ç–µ–º—É</span>
                </div>
            </div>
            <div class="settings-section">
                <h4>–¶–≤–µ—Ç –∞–∫—Ü–µ–Ω—Ç–∞</h4>
                <div class="theme-grid">
                    <div class="theme-option" data-theme="blue">üîµ –°–∏–Ω–∏–π</div>
                    <div class="theme-option" data-theme="green">üü¢ –ó–µ–ª—ë–Ω—ã–π</div>
                    <div class="theme-option" data-theme="purple">üü£ –§–∏–æ–ª–µ—Ç–æ–≤—ã–π</div>
                    <div class="theme-option" data-theme="gray">‚ö´ –°–µ—Ä—ã–π</div>
                </div>
            </div>
            <button class="reset-btn" id="resetSettingsBtn">–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <div class="close-modal">
                <button id="closeSettingsModal">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="participants-modal" class="modal">
        <div class="modal-content">
            <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏ —á–∞—Ç–∞</h3>
            <ul id="participants-list"></ul>
            <div class="close-modal">
                <button id="closeParticipantsModal">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="chat-details-modal" class="modal">
        <div class="modal-content">
            <h3>üìÑ –î–µ—Ç–∞–ª–∏ —á–∞—Ç–∞</h3>
            <div style="margin-bottom: 1rem;">
                <strong>–ò–º—è –≤ —á–∞—Ç–µ:</strong>
                <div style="background: var(--bg-input); padding: 0.5rem; border-radius: 8px; margin-top: 4px; word-break: break-all;" id="detailName"></div>
            </div>
            <div style="margin-bottom: 1rem;">
                <strong>–°–∏–¥-—Ñ—Ä–∞–∑–∞ (ID –≥—Ä—É–ø–ø—ã):</strong>
                <div style="background: var(--bg-input); padding: 0.5rem; border-radius: 8px; margin-top: 4px; word-break: break-all;" id="detailSeed"></div>
            </div>
            <div style="margin-bottom: 1rem;">
                <strong>–¢–æ–∫–µ–Ω:</strong>
                <div style="background: var(--bg-input); padding: 0.5rem; border-radius: 8px; margin-top: 4px; word-break: break-all;" id="detailToken"></div>
            </div>
            <div class="close-modal">
                <button id="closeDetailsModal">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div id="join-chat-modal" class="modal">
        <div class="modal-content">
            <h3>üîë –í—Ö–æ–¥ –≤ –≥—Ä—É–ø–ø—É</h3>
            <input type="text" id="joinSeedPhrase" class="seed-field" placeholder="–°–∏–¥-—Ñ—Ä–∞–∑–∞ (ID –≥—Ä—É–ø–ø—ã)" autocomplete="off">
            <input type="text" id="joinName" placeholder="–í–∞—à–µ –∏–º—è" autocomplete="off">
            <input type="text" id="joinToken" placeholder="–¢–æ–∫–µ–Ω –Ø–Ω–¥–µ–∫—Å–∞ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å y0_...)" autocomplete="off">
            <button id="joinChatBtn" class="modal-btn">–í–æ–π—Ç–∏</button>
            <button id="createNewFromJoinBtn" class="modal-btn" style="margin-top: 0.5rem;">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É</button>
            <div class="close-modal">
                <button id="closeJoinModal">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div id="avatar-modal" class="modal">
        <div class="modal-content">
            <h3>üì∑ –°–º–µ–Ω–∞ –∞–≤–∞—Ç–∞—Ä–∞</h3>
            <div class="avatar-preview">
                <img id="avatarPreview" src="" alt="–ü—Ä–µ–≤—å—é" style="max-width: 150px; max-height: 150px; border-radius: 50%; margin: 0 auto 1rem; display: none;">
            </div>
            <input type="file" id="avatarInput" accept="image/*">
            <div class="avatar-hint">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–¥–æ 2 –ú–ë)</div>
            <button id="uploadAvatarBtn" class="modal-btn">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            <button id="removeAvatarBtn" class="modal-btn" style="background: #b33; margin-top: 0.5rem;">–£–¥–∞–ª–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
            <div class="close-modal">
                <button id="closeAvatarModal">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <script src="script.js?v=3.0"></script>
</body>
</html>